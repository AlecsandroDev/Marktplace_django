{% extends 'comprador/base_comprador.html' %}
{% load static %}

{% block nav_inicio_active %}
{% if not request.GET.q_search and request.resolver_match.url_name == 'pagina_inicial_comprador' %}
active
{% endif %}
{% endblock nav_inicio_active %}

{% block content %}
<section class="filtros-section">
    <h2 class="section-title">Explore por Categorias</h2>
    <div class="filtros-categorias">
        <a href="{% url 'marketplace:pagina_inicial_comprador' %}"
            class="filtro-item {% if not selected_category_id or selected_category_id == 'todos' %}filtro-ativo{% endif %}">
            <div class="filtro-visual-container">
                <span class="filtro-icon-fallback" style="display:flex;">‚ú®</span>
            </div>
            <span class="filtro-nome-texto">Todos</span>
        </a>
        {% if filter_categorias %}
        {% for categoria in filter_categorias %}
        {% with image_filename=categoria.id|stringformat:"s"|add:".png" %}
        {% with image_full_path="comprador/image/"|add:image_filename %}
        <a href="{% url 'marketplace:pagina_inicial_comprador' %}?categoria={{ categoria.id }}"
            class="filtro-item {% if True %}filtro-ativo{% endif %}" {# CONDI√á√ÉO SIMPLIFICADA AQUI PARA TESTE #}
            data-filter-id="{{ categoria.id }}">
            <div class="filtro-visual-container">
                <img src="{% static image_full_path %}" alt="{{ categoria.nome_exibicao|default:'Categoria' }}"
                    class="filtro-imagem"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <span class="filtro-icon-fallback" style="display:none;">{{ categoria.icone|default:"üõçÔ∏è" }}</span>
            </div>
            <span class="filtro-nome-texto">{{ categoria.nome_exibicao|default:"Nome Categoria" }}</span>
        </a>
        {% endwith %}
        {% endwith %}
        {% endfor %}
        {% else %}
        <p>Nenhuma categoria dispon√≠vel no momento.</p>
        {% endif %}
    </div>
</section>

<section class="produtos-section">
    <h2 class="section-title">Produtos Dispon√≠veis</h2>
    <div class="produto-grid">
        {% if product_list %}
        {% for produto in product_list %}
        <div class="produto-card">
            <a href="{% url 'marketplace:comprador_produto_detalhes' produto_id=produto.id %}" class="produto-link">
                {% if produto.imagem %}
                <img src="{{ produto.imagem.url }}" alt="{{ produto.nome }}" class="produto-imagem">
                {% else %}
                <img src="{% static 'comprador/image/placeholder_produto.png' %}" alt="{{ produto.nome }}"
                    class="produto-imagem">
                {% endif %}
                <div class="produto-info">
                    <h3 class="produto-nome">{{ produto.nome }}</h3>
                    <p class="produto-vendedor">Por: {{ produto.vendedor.first_name|default:produto.vendedor.username }}
                    </p>
                    <p class="produto-preco">R$ {{ produto.preco }}</p>
                </div>
            </a>
            <div class="produto-card-actions">
                <button class="btn-adicionar-carrinho">Adicionar ao Carrinho</button>
                {% if produto.is_favorited %}
                <a href="{% url 'marketplace:comprador_desejos_remover' produto_id=produto.id %}"
                    class="btn-wishlist card-action active" title="Remover dos Desejos">
                    <img src="{% static 'comprador/image/bookmark_active.png' %}" alt="Favorito">
                </a>
                {% else %}
                <a href="{% url 'marketplace:comprador_desejos_adicionar' produto_id=produto.id %}"
                    class="btn-wishlist card-action" title="Adicionar aos Desejos">
                    <img src="{% static 'comprador/image/bookmark.png' %}" alt="N√£o Favorito">
                </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p>Nenhum produto encontrado para esta sele√ß√£o. Tente outros filtros ou veja todos os produtos!</p>
        {% endif %}
    </div>
</section>
{% endblock content %}