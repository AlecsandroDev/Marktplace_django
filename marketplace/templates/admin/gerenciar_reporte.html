{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Gerenciar Reporte #{{ reporte.id }}</title>
  <link rel="stylesheet" href="{% static 'admin/css/default_page.css' %}">
  <link rel="stylesheet" href="{% static 'admin/css/navbar.css' %}">
  <link rel="stylesheet" href="{% static 'admin/css/gerenciar_reporte.css' %}">
  <style>
    /* Estilos para as mensagens - Mova para o seu CSS externo se preferir */
    .messages {
      list-style-type: none;
      padding: 0;
      margin-bottom: 15px;
    }

    .message-item {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      color: white;
      text-align: center;
      border: 1px solid transparent;
    }

    .message-success {
      background-color: #28a745;
      border-color: #1e7e34;
    }

    .message-error {
      background-color: #dc3545;
      border-color: #b02a37;
    }

    .message-warning {
      background-color: #ffc107;
      color: #333;
      border-color: #d39e00;
    }

    .message-info {
      background-color: #17a2b8;
      border-color: #117a8b;
    }

    .message-default {
      background-color: #6c757d;
      border-color: #545b62;
    }
  </style>
</head>

<body>
  {% include 'admin/navbar.html' %}
  <div class="container">
    <h1>Detalhes do Reporte #{{ reporte.id }}: {{ reporte.titulo }}</h1>

    {% if messages %}
    <ul class="messages">
      {% for message in messages %}
      {% if message.tags == 'success' %}
      <li class="message-item message-success">{{ message }}</li>
      {% elif message.tags == 'error' %}
      <li class="message-item message-error">{{ message }}</li>
      {% elif message.tags == 'warning' %}
      <li class="message-item message-warning">{{ message }}</li>
      {% elif message.tags == 'info' %}
      <li class="message-item message-info">{{ message }}</li>
      {% else %}
      <li class="message-item message-default {{ message.tags }}">{{ message }}</li>
      {% endif %}
      {% endfor %}
    </ul>
    {% endif %}

    <div class="reporte-box">
      <div class="imagem-reporte">
        {% if reporte.imagem_evidencia %}
        <a href="{{ reporte.imagem_evidencia.url }}" target="_blank">
          <img src="{{ reporte.imagem_evidencia.url }}" alt="Evidência do Reporte" style="max-width:100%; height:auto;">
        </a>
        {% else %}
        <div class="placeholder">Sem Imagem de Evidência</div>
        {% endif %}
      </div>

      <div class="detalhes">
        <p><strong>Título:</strong> {{ reporte.titulo }}</p>
        <p><strong>Reportado por:</strong> {{ reporte.usuario_reportou.username|default:"Usuário Anônimo/Deletado" }}
        </p>
        {% if reporte.produto_reportado %}
        <p><strong>Produto Reportado:</strong> {{ reporte.produto_reportado.nome }} (ID: {{ reporte.produto_reportado.id
          }})
          - <a href="{% url 'marketplace:admin_gerenciar_anuncio' produto_id=reporte.produto_reportado.id %}"
            target="_blank">Ver Anúncio</a>
        </p>
        {% endif %}
        {% if reporte.usuario_alvo_reporte %}
        <p><strong>Usuário Alvo do Reporte:</strong> {{ reporte.usuario_alvo_reporte.username }}
          - <a href="{% url 'marketplace:admin_gerenciar_usuario' user_id=reporte.usuario_alvo_reporte.id %}"
            target="_blank">Ver Usuário</a>
        </p>
        {% endif %}
        <p class="descricao"><strong>Descrição do Reporte:</strong><br>{{ reporte.descricao|linebreaksbr }}</p>
        <p><strong>Data do Reporte:</strong> {{ reporte.data_criacao|date:"d/m/Y H:i:s" }}</p>
        <p><strong>Status Atual:</strong> {{ reporte.get_status_display }}</p>
        <p><strong>Última Atualização Admin:</strong> {{ reporte.data_ultima_atualizacao_admin|date:"d/m/Y H:i:s" }}</p>

        <hr style="margin: 20px 0;">
        <h3>Ações do Administrador</h3>
        <form method="POST" action="{% url 'marketplace:admin_gerenciar_reporte' reporte_id=reporte.id %}">
          {% csrf_token %}
          <div style="margin-bottom: 10px;">
            <label for="status">Mudar Status para:</label><br>
            <select name="status" id="status"
              style="padding: 8px; background-color: #444; color: white; border: 1px solid #555;">
              {% for value, display_name in status_choices %}
              <option value="{{ value }}" {% if reporte.status==value %}selected{% endif %}>{{ display_name }}</option>
              {% endfor %}
            </select>
          </div>
          <div style="margin-bottom: 10px;">
            <label for="notas_admin">Notas do Administrador:</label><br>
            <textarea name="notas_admin" id="notas_admin" rows="4"
              style="width: 100%; background-color: #444; color: white; border: 1px solid #555; padding: 8px;">{{ reporte.notas_admin|default:"" }}</textarea>
          </div>
          <button type="submit"
            style="padding: 10px 15px; background-color: #007bff; color:white; border:none; border-radius:4px; cursor:pointer;">Atualizar
            Reporte</button>
        </form>
      </div>
    </div>
    <div class="bottom-links" style="margin-top:20px;">
      <a href="{% url 'marketplace:admin_reportes' %}">Voltar para Reportes Ativos</a> |
      <a href="{% url 'marketplace:admin_reportes_arquivados' %}">Ver Reportes Arquivados</a>
    </div>
  </div>
</body>

</html>